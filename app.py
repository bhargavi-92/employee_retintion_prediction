{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "6874b7cc-79b4-481c-bec0-e5c8c1566cc4",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2025-12-28 12:27:26.867 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:26.868 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:27.630 \n",
      "  \u001b[33m\u001b[1mWarning:\u001b[0m to view this Streamlit app on a browser, run it with the following\n",
      "  command:\n",
      "\n",
      "    streamlit run C:\\Users\\Vedanthi BhargavI\\anaconda3\\Lib\\site-packages\\ipykernel_launcher.py [ARGUMENTS]\n",
      "2025-12-28 12:27:27.632 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:27.633 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:27.633 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:27.635 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:27.637 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:27.638 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:28.151 Thread 'Thread-3': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:28.156 Thread 'Thread-3': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.810 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.813 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.817 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.819 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.821 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.823 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.823 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.824 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.825 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.826 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.826 Session state does not function when running a script without `streamlit run`\n",
      "2025-12-28 12:27:30.827 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.827 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.828 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.830 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.830 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.832 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.833 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.834 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.834 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.835 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.835 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.837 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.838 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.838 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.839 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.840 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.841 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.843 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.845 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.846 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.848 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.849 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.849 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.850 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.851 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.852 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.853 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.853 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.854 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.855 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.856 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.856 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.856 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.858 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.858 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.860 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.860 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.861 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.862 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.862 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.863 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.864 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.864 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.866 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.866 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.867 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.868 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.868 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-12-28 12:27:30.869 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n"
     ]
    }
   ],
   "source": [
    "import streamlit as st\n",
    "import pandas as pd\n",
    "import numpy as np\n",
    "import pickle\n",
    "\n",
    "# ------------------------------\n",
    "# Page Config\n",
    "# ------------------------------\n",
    "st.set_page_config(\n",
    "    page_title=\"HR Attrition Prediction\",\n",
    "    page_icon=\"ðŸ“Š\",\n",
    "    layout=\"centered\"\n",
    ")\n",
    "\n",
    "st.title(\"ðŸ“Š Employee Attrition Prediction App\")\n",
    "st.write(\"Predict employee job change risk using ML\")\n",
    "\n",
    "# ------------------------------\n",
    "# Load Saved Objects\n",
    "# ------------------------------\n",
    "@st.cache_resource\n",
    "def load_artifacts():\n",
    "    model = pickle.load(open(\"best_lgbm.pkl\", \"rb\"))\n",
    "    cat_imputer = pickle.load(open(\"cat_imputer.pkl\", \"rb\"))\n",
    "    num_imputer = pickle.load(open(\"num_imputer.pkl\", \"rb\"))\n",
    "    encoder = pickle.load(open(\"encoder.pkl\", \"rb\"))\n",
    "    scaler = pickle.load(open(\"scaler.pkl\", \"rb\"))\n",
    "    train_columns = pickle.load(open(\"train_columns.pkl\", \"rb\"))\n",
    "    return model, cat_imputer, num_imputer, encoder, scaler, train_columns\n",
    "\n",
    "model, cat_imputer, num_imputer, encoder, scaler, train_columns = load_artifacts()\n",
    "\n",
    "# ------------------------------\n",
    "# Helper Functions\n",
    "# ------------------------------\n",
    "def encode_experience(df):\n",
    "    df = df.copy()\n",
    "    df[\"experience\"] = df[\"experience\"].replace({\"<1\": 0, \">20\": 21})\n",
    "    df[\"last_new_job\"] = df[\"last_new_job\"].replace({\"never\": 0, \">4\": 5})\n",
    "    df[\"experience\"] = pd.to_numeric(df[\"experience\"], errors=\"coerce\")\n",
    "    df[\"last_new_job\"] = pd.to_numeric(df[\"last_new_job\"], errors=\"coerce\")\n",
    "    return df\n",
    "\n",
    "def clean_feature_names(df):\n",
    "    df.columns = (\n",
    "        df.columns.str.replace('[', '', regex=False)\n",
    "        .str.replace(']', '', regex=False)\n",
    "        .str.replace('<', 'less_', regex=False)\n",
    "        .str.replace('>', 'greater_', regex=False)\n",
    "        .str.replace('/', '_', regex=False)\n",
    "        .str.replace(' ', '_', regex=False)\n",
    "    )\n",
    "    return df\n",
    "\n",
    "# ------------------------------\n",
    "# User Input Form\n",
    "# ------------------------------\n",
    "st.subheader(\"ðŸ§¾ Employee Details\")\n",
    "\n",
    "with st.form(\"prediction_form\"):\n",
    "    experience = st.selectbox(\"Experience\", [\"<1\", \"1\", \"2\", \"3\", \"4\", \"5\", \"10\", \">20\"])\n",
    "    last_new_job = st.selectbox(\"Last New Job Gap\", [\"never\", \"1\", \"2\", \"3\", \"4\", \">4\"])\n",
    "    training_hours = st.number_input(\"Training Hours\", 0, 500, 40)\n",
    "    education_level = st.selectbox(\"Education Level\", [\"Primary School\", \"High School\", \"Graduate\", \"Masters\", \"Phd\"])\n",
    "    company_type = st.selectbox(\"Company Type\", [\"Pvt Ltd\", \"Funded Startup\", \"Public Sector\", \"NGO\"])\n",
    "    company_size = st.selectbox(\"Company Size\", [\"<10\", \"10-49\", \"50-99\", \"100-500\", \"500-999\", \"1000+\"])\n",
    "    major_discipline = st.selectbox(\"Major Discipline\", [\"STEM\", \"Arts\", \"Humanities\", \"Business Degree\", \"Other\"])\n",
    "    gender = st.selectbox(\"Gender\", [\"Male\", \"Female\", \"Other\"])\n",
    "\n",
    "    submit = st.form_submit_button(\"ðŸ” Predict Attrition Risk\")\n",
    "\n",
    "# ------------------------------\n",
    "# Prediction Logic\n",
    "# ------------------------------\n",
    "if submit:\n",
    "    input_df = pd.DataFrame({\n",
    "        \"experience\": [experience],\n",
    "        \"last_new_job\": [last_new_job],\n",
    "        \"training_hours\": [training_hours],\n",
    "        \"education_level\": [education_level],\n",
    "        \"company_type\": [company_type],\n",
    "        \"company_size\": [company_size],\n",
    "        \"major_discipline\": [major_discipline],\n",
    "        \"gender\": [gender]\n",
    "    })\n",
    "\n",
    "    # Encode & clean\n",
    "    input_df = encode_experience(input_df)\n",
    "\n",
    "    cat_features = input_df.select_dtypes(include=\"object\").columns\n",
    "    num_features = input_df.select_dtypes(exclude=\"object\").columns\n",
    "\n",
    "    input_df[cat_features] = cat_imputer.transform(input_df[cat_features])\n",
    "    input_df[num_features] = num_imputer.transform(input_df[num_features])\n",
    "\n",
    "    encoded = encoder.transform(input_df[cat_features])\n",
    "    encoded_df = pd.DataFrame(encoded, columns=encoder.get_feature_names_out())\n",
    "\n",
    "    final_df = pd.concat([pd.DataFrame(input_df[num_features]), encoded_df], axis=1)\n",
    "    final_df = clean_feature_names(final_df)\n",
    "\n",
    "    final_df = final_df.reindex(columns=train_columns, fill_value=0)\n",
    "    final_df[num_features] = scaler.transform(final_df[num_features])\n",
    "\n",
    "    # Prediction\n",
    "    prob = model.predict_proba(final_df)[:, 1][0]\n",
    "    risk_score = round(prob * 100, 2)\n",
    "\n",
    "    if risk_score < 30:\n",
    "        risk_level = \"ðŸŸ¢ Low Risk\"\n",
    "    elif risk_score < 70:\n",
    "        risk_level = \"ðŸŸ  Medium Risk\"\n",
    "    else:\n",
    "        risk_level = \"ðŸ”´ High Risk\"\n",
    "\n",
    "    st.subheader(\"ðŸ“ˆ Prediction Result\")\n",
    "    st.metric(\"Attrition Risk Score\", f\"{risk_score}%\")\n",
    "    st.success(f\"Risk Level: {risk_level}\")\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "1eef1e1d-e4ac-495b-9fb3-27097503c118",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.13.5"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
